document.addEventListener("DOMContentLoaded",()=>{const a=document.querySelectorAll(".sound-item"),b=document.querySelector(".custom-volume"),c=document.querySelector(".general-volume .btn-play"),d=document.querySelector(".presets .load-set"),e=document.querySelector(".presets .save-set"),f=document.querySelector(".modal .btn.save"),g=document.querySelector(".modal-timer .btn.save-timer"),h=document.querySelectorAll(".modal .btn.cancel"),i=document.querySelector("#preset-name"),j=document.querySelector("#sound-icon"),k=document.querySelector(".general-volume input.general"),l=document.querySelector(".modal .default-presets"),m=document.querySelector(".modal .user-presets"),n=document.querySelector(".presets .timer"),o=document.querySelector("#timer"),p=document.querySelector("#timer-stop");let q,r=k.value,s={};null==localStorage.getItem("presets")&&(s=JSON.parse(localStorage.setItem("presets",s))),a.forEach(a=>{a.addEventListener("click",()=>{const b=a.querySelector(".shine");v(a),a.classList.contains("active")?t(a.querySelector(".sound-name").textContent,b.getAttribute("data-name"),b.getAttribute("data-color")):u(b.getAttribute("data-name"))})});const t=(a,d,e)=>{const f=document.createElement("div");f.classList.add("volume-slider"),f.innerHTML=`
            <div class="control">
                <span class="sound-name">${a}</span>
                <span class="close"><i class="fa fa-times" aria-hidden="true"></i></span>
            </div>
            <style class="${d}" data-name="${d}" scoped></style>
            <input type="range" min="10" max="100" value="50" data-color="${e}" data-name="${d}"class="slider ${d}">
        `,b.appendChild(f);const g=document.querySelector(`.sound-item.active .shine[data-name="${d}"]`).parentElement,h=document.querySelector(`#${d}`),i=document.querySelector(`input.slider.${d}`),j=b.querySelector(`.volume-slider input.slider.${d}`).parentElement,k=j.querySelector(".close");c.classList.contains("block")||(c.classList.add("playing"),c.innerHTML=`<i class="fa fa-pause" aria-hidden="true">`,h.play()),y(d,i.value,i.getAttribute("data-color")),h.volume=i.value/100,i.addEventListener("change",a=>{h.volume=a.target.value/100,y(d,a.target.value,a.target.getAttribute("data-color"))}),i.addEventListener("input",a=>y(d,a.target.value,a.target.getAttribute("data-color"))),k.addEventListener("click",()=>{u(d),v(g)})},u=a=>{const d=b.querySelector(`.volume-slider input.slider.${a}`).parentElement;b.removeChild(d),E(document.querySelector(`#${a}`)),0==b.children.length&&(c.innerHTML=`<i class="fa fa-play" aria-hidden="true">`,c.classList.remove("playing"))},v=a=>{const b=a.querySelector(".fade span"),c=a.querySelector(".sound-name"),d=a.querySelector(".shine");b.classList.toggle("bright"),c.classList.toggle("black"),d.classList.toggle("visible"),a.classList.toggle("active")};k.addEventListener("change",()=>w()),k.addEventListener("input",()=>w());const w=()=>{if(j.innerHTML=0==k.value?`<i class="fa fa-volume-off" aria-hidden="true"></i>`:`<i class="fa fa-volume-up" aria-hidden="true"></i>`,0!=b.children.length){const a=b.querySelectorAll("input"),d=r-k.value;0==k.value?a.forEach(a=>{const b=document.querySelector(`#${a.getAttribute("data-name")}`),c=a.getAttribute("data-color"),d=a.getAttribute("data-name");y(d,a.value,c),E(b),a.value=10}):a.forEach(a=>{const b=document.querySelector(`#${a.getAttribute("data-name")}`),e=a.getAttribute("data-color"),f=a.getAttribute("data-name");a.value-=d,y(f,a.value,e),c.classList.contains("playing")&&b.play(),b.volume=a.value/100})}y("general",k.value,"#fff"),r=k.value};c.addEventListener("click",()=>{c.classList.contains("playing")?(j.innerHTML=`<i class="fa fa-volume-off" aria-hidden="true"></i>`,x(!0,"play")):c.classList.contains("block")?(j.innerHTML=`<i class="fa fa-volume-up" aria-hidden="true"></i>`,x(!1,"pause")):(c.classList.toggle("playing"),c.innerHTML=`<i class="fa fa-pause" aria-hidden="true">`,setTimeout(()=>document.querySelector(".modal .default-presets .preset").click(),300))});const x=(a,d)=>{c.classList.toggle("playing"),c.classList.toggle("block"),c.innerHTML=`<i class="fa fa-${d}" aria-hidden="true">`;const e=b.querySelectorAll("input");e.forEach(b=>{const c=b.getAttribute("data-name"),d=document.querySelector(`#${c}`);a?E(d):d.play()})},y=(a,b,c)=>{let d=".slider.{class}::-webkit-slider-runnable-track{background:linear-gradient(90deg,{color} {value}%, #43444A 0)}",e=document.querySelector(`style.${a}`);d=d.replace("{class}",a),d=d.replace("{value}",b),d=d.replace("{color}",c),e.textContent=d};y("general",k.value,"#fff"),d.addEventListener("click",()=>{const a=document.querySelector(".modal.modal-load");a.classList.add("open"),document.body.style.overflow="hidden",z(a),B(a)}),e.addEventListener("click",()=>{const a=document.querySelector(".modal.modal-save");a.classList.add("open"),document.body.style.overflow="hidden",i.value="",A(a),B(a)});const z=a=>{let b=JSON.parse(localStorage.getItem("presets"));if(0!=Object.keys(b).length){let c=a.querySelector(".user-presets");for(const d in c.innerHTML=`<h3>Пользовательские пресеты</h3><div class="preset empty"><span>Вы еще не добавили свой пресет </span> <i class="fa fa-frown-o" aria-hidden="true"></i></div>`,a.querySelector(".user-presets .preset.empty").classList.add("hidden"),b)if(b.hasOwnProperty(d)){const a=b[d];let e=document.createElement("div");e.classList.add("preset");let f=document.createElement("div");f.classList.add("preset-name"),f.innerHTML=d;let g=document.createElement("div");g.classList.add("preset-sounds"),a.forEach(a=>{let b=document.createElement("div");b.classList.add("sound"),b.setAttribute("data-name",a.name),b.setAttribute("data-volume",a.volume),b.innerHTML=a.rusName,g.appendChild(b)});let h=document.createElement("div");h.classList.add("delete-preset"),h.innerHTML=`<i class="fa fa-trash" aria-hidden="true"></i>`,e.appendChild(f),e.appendChild(g),e.appendChild(h),c.appendChild(e)}}else a.querySelector(".user-presets .preset.empty").classList.remove("hidden");C(m),D()},A=()=>{document.querySelector(".modal-save .error").classList.add("hidden"),0==b.children.length?(document.querySelector(".modal-save .filled-list").classList.add("hidden"),document.querySelector(".modal-save .empty-list").classList.remove("hidden")):(document.querySelector(".modal-save .empty-list").classList.add("hidden"),document.querySelector(".modal-save .filled-list").classList.remove("hidden"))},B=a=>{const b=a.querySelector(".fade-modal"),c=a.querySelector(".close-modal");b.addEventListener("click",()=>{a.classList.remove("open"),document.body.style.overflow="visible"}),c.addEventListener("click",()=>{a.classList.remove("open"),document.body.style.overflow="visible"}),h.forEach(b=>{b.addEventListener("click",()=>{a.classList.remove("open"),document.body.style.overflow="visible"})})};f.addEventListener("click",()=>{let a=[],c=JSON.parse(localStorage.getItem("presets")),d=b.children;for(let b=0;b<d.length;b++){let c=d[b].querySelector("input").getAttribute("data-name"),e=d[b].querySelector("input").value,f=d[b].querySelector(".sound-name").textContent;a.push({name:c,volume:e,rusName:f})}if(!(i.value in c)){document.querySelector(".modal-save .error").classList.add("hidden"),c[`${i.value}`]=a;let b=JSON.stringify(c);localStorage.setItem("presets",b),document.querySelector(".modal.open").classList.remove("open"),document.body.style.overflow="visible"}else document.querySelector(".modal-save .error").classList.remove("hidden")});const C=a=>{const c=a.querySelectorAll(".preset");c.forEach(a=>{a.addEventListener("click",c=>{if(!c.target.classList.contains("fa")){c.target.classList.contains("preset")?c.target.classList.add("playing"):c.target.classList.contains("preset-name")||c.target.classList.contains("preset-sounds")?c.target.parentElement.classList.add("playing"):c.target.parentElement.parentElement.classList.add("playing");const d=b.querySelectorAll(".close");d.forEach(a=>{a.click()}),setTimeout(()=>{const b=a.querySelectorAll(".sound");b.forEach(a=>{const b=a.getAttribute("data-name"),c=document.querySelector(`.sounds .shine[data-name="${b}"]`),d=a.getAttribute("data-volume"),e=c.getAttribute("data-color");c.click(),document.querySelector(`.custom-volume input[data-name="${b}"]`).value=d,y(b,d,e)})},300)}})})};C(l);const D=()=>{const a=document.querySelectorAll(".modal .user-presets .delete-preset");a.forEach(a=>{a.addEventListener("click",a=>{let c=a.target.parentElement.parentElement.parentElement,d=a.target.parentElement.parentElement,e=d.querySelector(".preset-name").textContent;c.removeChild(d);let f=JSON.parse(localStorage.getItem("presets"));delete f[e];let g=JSON.stringify(f);if(localStorage.setItem("presets",g),presetsList=document.querySelectorAll(".modal .user-presets .preset"),d.classList.contains("playing")){const a=b.querySelectorAll(".close");a.forEach(a=>{a.click()})}1==presetsList.length&&document.querySelector(".modal .user-presets .preset.empty").classList.remove("hidden")})})};n.addEventListener("click",()=>{const a=document.querySelector(".modal.modal-timer");a.classList.add("open"),document.body.style.overflow="hidden",B(a)}),o.addEventListener("change",()=>{y("time",o.value,"#fff"),document.querySelector(".modal .time-control span").textContent=`${o.value} мин`}),o.addEventListener("input",()=>{y("time",o.value,"#fff"),document.querySelector(".modal .time-control span").textContent=`${o.value} мин`}),document.querySelector(".modal .time-control span").textContent=`10 мин`,y("time",o.value,"#fff"),g.addEventListener("click",()=>{const a=a=>{let b=Date.parse(a)-Date.parse(new Date),c=Math.floor(b/1e3%60),d=Math.floor(b/1e3/60%60),e=Math.floor(b/3600000%24);return{total:b,hours:e,minutes:d,seconds:c}};let c=new Date(Date.parse(new Date)+1e3*(60*o.value));((c,d)=>{0==b.children.length&&setTimeout(()=>document.querySelector(".modal .default-presets .preset").click(),300),document.querySelector("#timer-left").classList.remove("hidden"),document.querySelector(".presets .timer").style.color="#F9CF05",p.classList.remove("hidden");let e=document.getElementById(c),f=e.querySelector(".hours"),g=e.querySelector(".minutes"),h=e.querySelector(".seconds");const i=()=>{let c=a(d);if(0>=c.total){clearInterval(q),document.querySelector("#timer-left").classList.add("hidden"),p.classList.add("hidden"),document.querySelector(".presets .timer").style.color="#fff";const a=b.querySelectorAll(".close");a.forEach(a=>{a.click()})}f.innerHTML=("0"+c.hours).slice(-2),g.innerHTML=("0"+c.minutes).slice(-2),h.innerHTML=("0"+c.seconds).slice(-2)};i(),q=setInterval(i,1e3)})("timer-left",c);let d=document.querySelector(".modal.open");d.classList.remove("open"),document.body.style.overflow="visible"}),p.addEventListener("click",a=>{a.stopPropagation(),clearInterval(q),document.querySelector("#timer-left").classList.add("hidden"),p.classList.add("hidden"),document.querySelector(".presets .timer").style.color="#fff";const c=b.querySelectorAll(".close");c.forEach(a=>{a.click()})});const E=a=>{a.pause(),a.currentTime=0}});
